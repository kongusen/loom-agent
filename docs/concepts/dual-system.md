# 双系统架构 (Dual-Process Architecture)

Loom 借鉴了认知心理学（如丹尼尔·卡尼曼的《思考，快与慢》）中的**双过程理论**，实现了一个能够在直觉反应和从容推理之间动态切换的混合认知系统。

## 什么是 System 1 和 System 2？

### System 1 (快思考)
- **特征**：快速、直觉、启发式、低延迟。
- **Loom 实现**：直接的 LLM 调用，使用较短的 prompt，直接流式输出给用户。不涉及复杂的规划或反思循环。
- **适用场景**：
    - 闲聊 ("你好")
    - 简单的事实查询 ("法国的首都是哪里？")
    - 只要速度不需要深度的场景。

### System 2 (慢思考)
- **特征**：缓慢、审慎、逻辑性强、高消耗。
- **Loom 实现**：涉及思维链 (CoT)、多步规划、工具使用循环、自我反思和修正。
- **适用场景**：
    - 复杂推理 ("分析这家公司的财报")
    - 代码生成与调试
    - 多步骤任务执行

## 认知路由器 (The Cognitive Router)

Loom 的核心是一个**自适应路由器 (Adaptive Router)**，它位于用户输入和 Agent 执行之间。它分析传入的查询并决定路由到哪个系统。

### 路由逻辑

路由器通过以下方式评估查询：

1.  **复杂度评分**：分析 Tokens 数量、意图深度。
2.  **模式匹配**：检测是否包含代码、数学公式或复杂的指令关键词（如 "计划"、"比较"、"分析"）。
3.  **记忆上下文**：检查之前的交互是否暗示了当前需要的深度。

### 决策流程
```mermaid
graph TD
    A[用户输入] --> B{认知路由器}
    B -- 简单/闲聊 --> C[System 1 (直觉)]
    B -- 复杂/代码/规划 --> D[System 2 (推理)]
    C --> E[响应用户]
    D --> E
    C -- 置信度低 --> F[回退到 System 2]
    F --> E
```

### 置信度与回退 (Fallback)

即便选择了 System 1，系统也会并行运行一轻量级的监控器。如果 System 1 的输出被判定为低质量（例如，出现了幻觉特征，或者未能遵循指令），路由器可以触发**热切换**，无缝地激活 System 2 来重新处理请求，确保用户体验和准确性。

## 使用案例

*   **System 1**:
    *   "即使给我讲个笑话。"
    *   "在这个上下文中 'Loom' 是什么意思？"
*   **System 2**:
    *   "写一个 Python 脚本来抓取这个网站。"
    *   "分析过去 5 年的市场趋势。"
    *   "制定一个旅行计划。"

## 认知配置

你可以通过 `AdaptiveRouterConfig` 配置双系统的行为：

```python
from loom.cognition import AdaptiveRouter, RouterConfig

config = RouterConfig(
    default_mode="balanced",  # 'fast' (快), 'balanced' (平衡), 'deep' (深)
    code_trigger=True,        # 遇到代码强制使用 System 2
    min_confidence=0.7        # 回退阈值
)
```
