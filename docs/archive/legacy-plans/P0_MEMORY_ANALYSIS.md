# P0-1: è®°å¿†ç³»ç»Ÿæ ¸å¿ƒ - é‡æ„åˆ†æ

## æ—§å®ç°åˆ†æ

### ä»£ç è§„æ¨¡
- `core.py`: 670è¡Œ
- `types.py`: ~100è¡Œ
- `compression.py`: æœªçŸ¥
- `vector_store.py`: æœªçŸ¥

### MemoryUnitå­—æ®µåˆ†æ

| å­—æ®µ | ç”¨é€” | æ˜¯å¦å¿…éœ€ | åˆ¤æ–­ |
|------|------|----------|------|
| `id` | å”¯ä¸€æ ‡è¯† | âœ… å¿…éœ€ | æ ¸å¿ƒå­—æ®µ |
| `content` | å®é™…å†…å®¹ | âœ… å¿…éœ€ | æ ¸å¿ƒå­—æ®µ |
| `tier` | L1-L4å±‚çº§ | âœ… å¿…éœ€ | A4å…¬ç†è¦æ±‚ |
| `type` | å†…å®¹ç±»å‹ | âœ… å¿…éœ€ | ç”¨äºåˆ†ç±»å’Œè¿‡æ»¤ |
| `source_node` | æ¥æºèŠ‚ç‚¹ | ğŸ¤” å¯é€‰ | è°ƒè¯•æœ‰ç”¨ï¼Œä½†éæ ¸å¿ƒ |
| `parent_id` | çˆ¶è®°å¿†ID | âŒ ä¸éœ€è¦ | è¿‡åº¦è®¾è®¡ï¼Œå¢åŠ å¤æ‚åº¦ |
| `created_at` | åˆ›å»ºæ—¶é—´ | âœ… å¿…éœ€ | L1å¾ªç¯ç¼“å†²éœ€è¦ |
| `accessed_at` | è®¿é—®æ—¶é—´ | âŒ ä¸éœ€è¦ | è¿‡åº¦è®¾è®¡ï¼Œå¾ˆå°‘ä½¿ç”¨ |
| `metadata` | æ‰©å±•å­—æ®µ | âœ… å¿…éœ€ | çµæ´»æ€§ |
| `embedding` | å‘é‡åµŒå…¥ | âœ… å¿…éœ€ | L4è¯­ä¹‰æœç´¢ |
| `importance` | é‡è¦æ€§åˆ†æ•° | âœ… å¿…éœ€ | L4å‹ç¼©éœ€è¦ |
| `status` | ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ | âŒ ä¸éœ€è¦ | è¿‡åº¦è®¾è®¡ï¼Œ4ä¸ªçŠ¶æ€å¤ªå¤š |

**ç»“è®º**ï¼š12ä¸ªå­—æ®µä¸­ï¼Œ8ä¸ªå¿…éœ€ï¼Œ4ä¸ªå¯ä»¥å»é™¤ã€‚

---

## æ–°å®ç°è®¾è®¡

### ç®€åŒ–çš„MemoryUnit

```python
@dataclass
class MemoryUnit:
    """è®°å¿†å•å…ƒ - ç®€åŒ–ç‰ˆ"""
    id: str = field(default_factory=lambda: str(uuid.uuid4()))
    content: Any = None
    tier: MemoryTier = MemoryTier.L2_WORKING
    type: MemoryType = MemoryType.MESSAGE
    created_at: datetime = field(default_factory=datetime.now)
    metadata: dict[str, Any] = field(default_factory=dict)
    embedding: list[float] | None = None
    importance: float = 0.5
```

**å‡å°‘**ï¼šä»12ä¸ªå­—æ®µåˆ°8ä¸ªå­—æ®µ

---

## æ ¸å¿ƒåŠŸèƒ½åˆ†æ

### å¿…éœ€åŠŸèƒ½

1. **L1ç®¡ç†** - å¾ªç¯ç¼“å†²åŒº
   - `add()` - æ·»åŠ åˆ°L1
   - `_evict_from_l1()` - è¶…è¿‡å®¹é‡æ—¶é©±é€æœ€æ—§çš„

2. **L2ç®¡ç†** - å·¥ä½œè®°å¿†
   - `add()` - æ·»åŠ åˆ°L2
   - `clear_l2()` - ä»»åŠ¡ç»“æŸæ—¶æ¸…ç©º

3. **L3ç®¡ç†** - ä¼šè¯è®°å¿†
   - `add()` - æ·»åŠ åˆ°L3ï¼ˆæŒ‰session_idåˆ†ç»„ï¼‰
   - `clear_l3()` - ä¼šè¯ç»“æŸæ—¶æ¸…ç©º

4. **L4ç®¡ç†** - å…¨å±€çŸ¥è¯†åº“
   - `add()` - æ·»åŠ åˆ°L4
   - `_vectorize_unit()` - å‘é‡åŒ–
   - `_compress_l4()` - è‡ªåŠ¨å‹ç¼©
   - `search_l4()` - è¯­ä¹‰æœç´¢

5. **ä¸Šä¸‹æ–‡æ„å»º**
   - `build_context()` - ä»L1-L4é€‰æ‹©ç›¸å…³è®°å¿†

### å¯é€‰åŠŸèƒ½ï¼ˆæš‚ä¸å®ç°ï¼‰

- âŒ æŠ•å½±ç³»ç»Ÿï¼ˆProjectionConfigï¼‰
- âŒ å¤æ‚çš„ç´¢å¼•ç³»ç»Ÿï¼ˆtype_indexï¼‰
- âŒ è®°å¿†çŠ¶æ€ç®¡ç†ï¼ˆMemoryStatusï¼‰
- âŒ çˆ¶å­å…³ç³»è¿½è¸ªï¼ˆparent_idï¼‰

---

## å®ç°è®¡åˆ’

### æ–‡ä»¶ç»“æ„

```
loom/memory/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ types.py          # ç±»å‹å®šä¹‰ï¼ˆ~80è¡Œï¼‰
â”œâ”€â”€ core.py           # æ ¸å¿ƒå®ç°ï¼ˆ~300è¡Œï¼Œä»670è¡Œç®€åŒ–ï¼‰
â”œâ”€â”€ compression.py    # L4å‹ç¼©ï¼ˆ~150è¡Œï¼‰
â””â”€â”€ vector_store.py   # å‘é‡å­˜å‚¨æ¥å£ï¼ˆ~100è¡Œï¼‰
```

**æ€»è®¡**ï¼š~630è¡Œï¼ˆvs æ—§å®ç°çš„~1000+è¡Œï¼‰

### å®ç°é¡ºåº

1. **types.py** - å®šä¹‰ç®€åŒ–çš„ç±»å‹
2. **core.py** - å®ç°æ ¸å¿ƒL1-L4ç®¡ç†
3. **compression.py** - å®ç°L4å‹ç¼©
4. **vector_store.py** - å‘é‡å­˜å‚¨æ¥å£

